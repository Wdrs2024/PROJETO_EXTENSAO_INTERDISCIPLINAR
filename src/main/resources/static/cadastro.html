<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <title>Cadastro de Cliente</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet" />
    <style>
        body {
          font-family: 'Roboto', sans-serif;
          background-color: #f4f7f8;
          margin: 0;
          padding: 0;
        }
        h1 {
          text-align: center;
          color: #333;
          margin-top: 40px;
        }
        form {
          max-width: 400px;
          margin: 30px auto;
          padding: 20px;
          background-color: #ffffff;
          border-radius: 8px;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        label {
          font-weight: bold;
          display: block;
          margin-top: 15px;
          color: #444;
        }
        input {
          width: 100%;
          padding: 8px;
          margin-top: 5px;
          border: 1px solid #ccc;
          border-radius: 4px;
          box-sizing: border-box;
          font-size: 14px;
        }
        .error-message {
          color: #e74c3c;
          font-size: 12px;
          margin-top: 4px;
          height: 14px; /* para não desalinhar layout */
        }
        button {
          margin-top: 20px;
          width: 100%;
          padding: 10px;
          background-color: #3498db;
          border: none;
          color: white;
          font-size: 16px;
          border-radius: 4px;
          cursor: pointer;
        }
        button:hover {
          background-color: #2980b9;
        }
    </style>
</head>
<body>

<h1>Cadastro de Cliente</h1>

<form id="formCliente" novalidate>
    <label for="nome">Nome:</label>
    <input type="text" id="nome" name="nome" required />
    <div class="error-message" id="erro-nome"></div>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required />
    <div class="error-message" id="erro-email"></div>

    <label for="telefone">Telefone:</label>
    <input type="text" id="telefone" name="telefone" required pattern="\d{10,11}" title="Telefone deve conter 10 ou 11 dígitos numéricos" />
    <div class="error-message" id="erro-telefone"></div>

    <label for="endereco">Endereço:</label>
    <input type="text" id="endereco" name="endereco" required />
    <div class="error-message" id="erro-endereco"></div>

    <label for="cpf">CPF:</label>
    <input type="text" id="cpf" name="cpf" required pattern="[0-9]{11}" title="CPF deve conter 11 números sem pontos ou traços" />
    <div class="error-message" id="erro-cpf" style="color: red; font-size: 0.9em;"></div>


    <button type="submit">Enviar</button>
</form>

<script>
    // Função para validar CPF brasileiro
    function validarCPF(cpf) {
      cpf = cpf.replace(/[^\d]+/g, '');
      if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;

      let soma = 0;
      for (let i = 0; i < 9; i++) soma += parseInt(cpf.charAt(i)) * (10 - i);
      let resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf.charAt(9))) return false;

      soma = 0;
      for (let i = 0; i < 10; i++) soma += parseInt(cpf.charAt(i)) * (11 - i);
      resto = (soma * 10) % 11;
      if (resto === 10 || resto === 11) resto = 0;
      if (resto !== parseInt(cpf.charAt(10))) return false;

      return true;
    }

    // Função para validar email simples
    function validarEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // Função para validar telefone (10 ou 11 números)
    function validarTelefone(telefone) {
      const re = /^\d{10,11}$/;
      return re.test(telefone);
    }

    const form = document.getElementById('formCliente');

    form.addEventListener('submit', function(event) {
      event.preventDefault();

      // Limpar mensagens antigas
      document.querySelectorAll('.error-message').forEach(el => el.textContent = '');

      // Captura valores
      const nome = form.nome.value.trim();
      const email = form.email.value.trim();
      const telefone = form.telefone.value.trim();
      const endereco = form.endereco.value.trim();
      const cpf = form.cpf.value.trim();

      let valido = true;

      // Validar nome
      if (!nome) {
        document.getElementById('erro-nome').textContent = 'Por favor, insira o nome.';
        valido = false;
      }

      // Validar email
      if (!email) {
        document.getElementById('erro-email').textContent = 'Por favor, insira o email.';
        valido = false;
      } else if (!validarEmail(email)) {
        document.getElementById('erro-email').textContent = 'Email inválido.';
        valido = false;
      }

      // Validar telefone
      if (!telefone) {
        document.getElementById('erro-telefone').textContent = 'Por favor, insira o telefone.';
        valido = false;
      } else if (!validarTelefone(telefone)) {
        document.getElementById('erro-telefone').textContent = 'Telefone inválido. Use 10 ou 11 dígitos numéricos.';
        valido = false;
      }

      // Validar endereço
      if (!endereco) {
        document.getElementById('erro-endereco').textContent = 'Por favor, insira o endereço.';
        valido = false;
      }

      // Validar CPF
      if (!cpf) {
        document.getElementById('erro-cpf').textContent = 'Por favor, insira o CPF.';
        valido = false;
      } else if (!validarCPF(cpf)) {
        document.getElementById('erro-cpf').textContent = 'CPF inválido.';
        valido = false;
      }

      if (!valido) return;

      // Se passou na validação, enviar os dados via fetch
      const cliente = { nome, email, telefone, endereco, cpf };

      fetch('/clientes', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(cliente),
      })
      .then(response => {
        if (response.ok) {
          alert('Cliente cadastrado com sucesso!');
          form.reset();
        } else {
          alert('Erro ao cadastrar cliente.');
        }
      })
      .catch(error => {
        alert('Erro ao enviar requisição.');
        console.error(error);
      });
    });
</script>

</body>
</html>
